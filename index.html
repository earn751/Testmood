<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grip Coin Mini</title>
    <!-- Tailwind CSS from CDN (production use) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&display=swap');
        * {
            font-family: 'Hind Siliguri', sans-serif;
        }
        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #0d9488;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Monetag Script -->
    <script type="text/javascript">
        (function() {
            var script = document.createElement('script');
            script.type = 'text/javascript';
            script.src = '//monetag.com/some-path/loader.js';
            script.async = true;
            document.head.appendChild(script);
        })();
    </script>
</head>
<body class="bg-gradient-to-br from-slate-900 to-slate-800 min-h-screen text-white">
    <div id="app" class="flex flex-col min-h-screen">
        <!-- Header -->
        <header class="bg-slate-800/50 backdrop-blur-sm border-b border-slate-700 py-4 px-6">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-teal-500 rounded-lg flex items-center justify-center">
                        <span class="text-xl font-bold">üëä</span>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-teal-400">Grip Coin</h1>
                        <p class="text-xs text-gray-400">‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ Mini App</p>
                    </div>
                </div>
                <div id="user-balance" class="text-right">
                    <p class="text-sm text-gray-400">‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</p>
                    <p class="text-xl font-bold text-white">0</p>
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <main id="app-container" class="flex-grow overflow-y-auto pb-20">
            <!-- Content will be rendered here -->
            <div class="flex items-center justify-center h-64">
                <div class="loader"></div>
            </div>
        </main>

        <!-- Navigation Bar -->
        <nav class="fixed bottom-0 left-0 right-0 bg-slate-800/80 backdrop-blur-sm border-t border-slate-700 h-16">
            <div class="flex justify-around h-full max-w-lg mx-auto">
                <button data-page="grip" class="nav-btn flex flex-col items-center justify-center p-2 text-xs transition-all duration-200 text-teal-400 scale-110">
                    <svg class="w-6 h-6 mb-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                    </svg>
                    <span class="font-medium">Grip</span>
                </button>
                <button data-page="transfer" class="nav-btn flex flex-col items-center justify-center p-2 text-xs transition-all duration-200 text-gray-400 hover:text-teal-300">
                    <svg class="w-6 h-6 mb-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                    </svg>
                    <span class="font-medium">Transfer</span>
                </button>
                <button data-page="news" class="nav-btn flex flex-col items-center justify-center p-2 text-xs transition-all duration-200 text-gray-400 hover:text-teal-300">
                    <svg class="w-6 h-6 mb-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9"></path>
                    </svg>
                    <span class="font-medium">News</span>
                </button>
                <button data-page="profile" class="nav-btn flex flex-col items-center justify-center p-2 text-xs transition-all duration-200 text-gray-400 hover:text-teal-300">
                    <svg class="w-6 h-6 mb-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                    <span class="font-medium">Profile</span>
                </button>
            </div>
        </nav>

        <!-- Status Message -->
        <div id="status-message" class="fixed top-20 left-1/2 transform -translate-x-1/2 z-50 max-w-sm w-full px-4 hidden">
            <div class="bg-slate-800/90 backdrop-blur-sm border border-slate-600 rounded-lg p-4 shadow-2xl">
                <p id="status-text" class="text-center text-sm"></p>
            </div>
        </div>
    </div>

    <script>
        // --- App State Management ---
        const state = {
            currentPage: 'grip',
            userData: {
                balance: 0,
                telegramUsername: 'User',
                telegramId: null,
                referralCode: 'REF123'
            },
            transactions: [],
            newsPosts: [],
            referrals: [],
            
            // Grip State
            isTapping: false,
            tapInterval: null,
            coinMultiplier: 1,
            coinsPerTick: 5,
            adRewardActive: false,
            adRewardDuration: 0,

            // Transfer State
            transferRecipient: '',
            transferAmount: '',
            recipientData: null
        };

        // --- Telegram WebApp Integration ---
        const tg = window.Telegram?.WebApp;

        // Initialize Telegram WebApp
        const initTelegramApp = () => {
            if (tg) {
                tg.expand();
                tg.enableClosingConfirmation();
                
                // Get user data from Telegram
                const user = tg.initDataUnsafe?.user;
                if (user) {
                    state.userData.telegramUsername = user.username || `user_${user.id}`;
                    state.userData.telegramId = user.id;
                    state.userData.referralCode = `TG${user.id}`;
                    
                    // Send new user notification to admin
                    sendNewUserNotification(user);
                }
                
                // Apply Telegram theme
                if (tg.colorScheme === 'dark') {
                    document.body.classList.add('bg-slate-900');
                } else {
                    document.body.classList.remove('bg-slate-900');
                    document.body.classList.add('bg-gray-100', 'text-gray-900');
                }
                
                console.log('Telegram WebApp initialized successfully');
            } else {
                console.log('Telegram WebApp not detected, using demo mode');
                // Demo data for development
                state.userData.telegramUsername = 'demo_user';
                state.userData.telegramId = '123456789';
                state.userData.balance = 1000;
                
                // Add demo transactions
                state.transactions = [
                    { type: 'GRIP', amount: 50, timestamp: new Date(Date.now() - 300000) },
                    { type: 'GRIP', amount: 75, timestamp: new Date(Date.now() - 600000) },
                    { type: 'TRANSFER_RECEIVED', amount: 200, timestamp: new Date(Date.now() - 86400000) }
                ];
                
                // Add demo news
                state.newsPosts = [
                    {
                        title: '‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ Grip Coin ‡¶è!',
                        caption: '‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡¶≠‡¶ø‡¶ú‡ßç‡¶û‡¶§‡¶æ ‡¶Ü‡¶∞‡¶ì ‡¶â‡¶®‡ßç‡¶®‡¶§ ‡¶ï‡¶∞‡¶§‡ßá ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶®‡¶§‡ßÅ‡¶® ‡¶´‡¶ø‡¶ö‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßá‡¶õ‡¶ø‡•§',
                        buttonLink: 'https://t.me/your_telegram_channel',
                        timestamp: new Date(Date.now() - 172800000)
                    }
                ];
            }
        };

        // --- New User Notification to Admin ---
        const sendNewUserNotification = (user) => {
            const message = `üÜï ‡¶®‡¶§‡ßÅ‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!\n\n` +
                          `‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ: ${user.username || 'N/A'}\n` +
                          `‡¶Ü‡¶á‡¶°‡¶ø: ${user.id}\n` +
                          `‡¶®‡¶æ‡¶Æ: ${user.first_name || ''} ${user.last_name || ''}\n` +
                          `‡¶≠‡¶æ‡¶∑‡¶æ: ${user.language_code || 'N/A'}\n` +
                          `‡¶∏‡¶Æ‡¶Ø‡¶º: ${new Date().toLocaleString('bn-BD')}`;
            
            // For now, we'll just log it
            console.log('New User Notification:', message);
        };

        // --- Utility Functions ---
        const formatBalance = (num) => (num || 0).toLocaleString('en-US', { maximumFractionDigits: 2 });
        
        const formatDate = (date) => {
            return date.toLocaleDateString('bn-BD', {
                day: '2-digit', month: 'short', year: 'numeric', 
                hour: '2-digit', minute: '2-digit'
            });
        };

        const showStatus = (message, isError = false) => {
            const statusEl = document.getElementById('status-message');
            const statusText = document.getElementById('status-text');
            
            statusText.textContent = message;
            statusText.className = `text-center text-sm ${isError ? 'text-red-400' : 'text-green-400'}`;
            statusEl.classList.remove('hidden');
            
            setTimeout(() => {
                statusEl.classList.add('hidden');
            }, 3000);
        };

        // --- Monetag Ad Integration ---
        const showAutoInterstitialAd = () => {
            if (typeof show_10087307 === 'function') {
                try {
                    // Simulating ad logic
                    console.log("Auto Interstitial ad shown (simulated)");
                } catch(e) {
                    console.error("Auto Interstitial failed:", e);
                }
            }
        };

        const showMonetagRewardedAd = () => {
            if (state.adRewardActive) {
                showStatus('‡¶¨‡ßã‡¶®‡¶æ‡¶∏‡¶ü‡¶ø ‡¶è‡¶ñ‡¶®‡¶ì ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡ßü ‡¶Ü‡¶õ‡ßá‡•§', true);
                return;
            }
            
            if (typeof show_10087307 !== 'function') {
                showStatus('‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡¶®‡¶ø‡•§', true);
                return;
            }

            showStatus('‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...');

            // Simulating a successful ad view
            new Promise(resolve => setTimeout(resolve, 2000)).then(() => {
                const duration = 5 * 60;
                state.coinMultiplier = 5;
                state.adRewardActive = true;
                state.adRewardDuration = duration;
                
                const timer = setInterval(() => {
                    state.adRewardDuration -= 1;
                    if (state.adRewardDuration <= 0) {
                        clearInterval(timer);
                        state.adRewardActive = false;
                        state.coinMultiplier = 1;
                        showStatus("‡¶ï‡ßü‡ßá‡¶® ‡¶Æ‡¶æ‡¶≤‡ßç‡¶ü‡¶ø‡¶™‡ßç‡¶≤‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶∂‡ßá‡¶∑‡•§");
                    }
                    renderCurrentPage();
                }, 1000);
                
                showStatus("‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶∏‡¶´‡¶≤! ‡¶ï‡¶Ø‡¶º‡ßá‡¶® ‡¶∏‡¶Ç‡¶ó‡ßç‡¶∞‡¶π ‡ß´√ó ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!");
                renderCurrentPage();
            }).catch(e => {
                console.error("Rewarded ad failed:", e);
                showStatus("‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶≤‡ßã‡¶° ‡¶π‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•‡•§", true);
            });
        };

        const showMonetagRewardedPopup = () => {
            if (typeof show_10087307 !== 'function') {
                showStatus('‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡¶®‡¶ø‡•§', true);
                return;
            }

            showStatus('‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...');

            // Simulating a successful ad view
            new Promise(resolve => setTimeout(resolve, 1500)).then(() => {
                const bonusAmount = 100;
                state.userData.balance += bonusAmount;
                
                state.transactions.unshift({
                    type: 'AD_REWARD',
                    amount: bonusAmount,
                    timestamp: new Date()
                });
                
                showStatus(`‡¶∏‡¶´‡¶≤! ${bonusAmount} ‡¶ï‡¶Ø‡¶º‡ßá‡¶® ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶™‡ßá‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡¶®!`);
                updateBalanceDisplay();
                renderCurrentPage();
            }).catch(e => {
                console.error("Popup ad failed:", e);
                showStatus("‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø‡•§", true);
            });
        };

        // --- Realtime Data Loading & Update Logic (NEW) ---

        /**
         * ‡¶∞‡¶ø‡ßü‡ßá‡¶≤-‡¶ü‡¶æ‡¶á‡¶Æ ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶ï‡¶≤‡ßá‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶ï‡¶∞‡¶£ ‡¶ï‡¶∞‡ßá‡•§
         * ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßá ‡¶è‡¶¨‡¶Ç ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶Ü‡¶∞‡ßç‡¶®‡¶ø‡¶Ç ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßá‡•§
         */
        const fetchDataFromServer = async () => {
            // ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶ï‡¶≤‡ßá‡¶∞ ‡¶¨‡¶ø‡¶≤‡¶Æ‡ßç‡¶¨ (latency) ‡¶Ö‡¶®‡ßÅ‡¶ï‡¶∞‡¶£
            await new Promise(resolve => setTimeout(resolve, 500)); 

            // ‡¶∞‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶Æ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶Ü‡¶∞‡ßç‡¶®‡¶ø‡¶Ç
            const backgroundEarnings = Math.floor(Math.random() * 5); // 0 ‡¶•‡ßá‡¶ï‡ßá 4 ‡¶ï‡¶Ø‡¶º‡ßá‡¶®

            if (backgroundEarnings > 0) {
                state.userData.balance += backgroundEarnings;
                
                state.transactions.unshift({
                    type: 'BACKGROUND_EARN',
                    amount: backgroundEarnings,
                    timestamp: new Date()
                });
                
                console.log(`Realtime update: +${backgroundEarnings} coins`);
            }
            
            // ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡¶ú‡ßá‡¶ï‡¶∂‡¶® ‡¶è‡¶¨‡¶Ç ‡¶®‡¶ø‡¶â‡¶ú ‡¶™‡ßã‡¶∏‡ßç‡¶ü‡¶ó‡ßÅ‡¶≤‡ßã‡¶ï‡ßá ‡¶∏‡¶Æ‡ßü‡ßá‡¶∞ ‡¶ï‡ßç‡¶∞‡¶Æ‡¶æ‡¶®‡ßÅ‡¶∏‡¶æ‡¶∞‡ßá ‡¶∏‡¶æ‡¶ú‡¶æ‡¶®‡ßã
            state.transactions.sort((a, b) => b.timestamp - a.timestamp);
            state.newsPosts.sort((a, b) => b.timestamp - a.timestamp);
            
            updateBalanceDisplay();
            
            // ‡¶Ø‡¶¶‡¶ø ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶¨‡¶æ ‡¶®‡¶ø‡¶â‡¶ú ‡¶™‡ßá‡¶ú‡ßá ‡¶•‡¶æ‡¶ï‡ßá, ‡¶§‡¶æ‡¶π‡¶≤‡ßá ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶¨‡ßá ‡¶Ø‡¶æ‡¶§‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶Ø‡¶æ‡ßü
            if (state.currentPage === 'profile' || state.currentPage === 'news') {
                renderCurrentPage();
            }
            
            // ‡¶Ø‡¶¶‡¶ø ‡¶è‡¶ü‡¶ø ‡¶á‡¶®‡¶ø‡¶∂‡¶ø‡ßü‡¶æ‡¶≤ ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º, ‡¶§‡¶¨‡ßá ‡¶™‡ßá‡¶ú‡¶ü‡¶ø ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡¶¨‡¶æ‡¶∞ ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶≤‡ßã‡¶°‡¶æ‡¶∞ ‡¶∏‡¶∞‡¶ø‡ßü‡ßá ‡¶¶‡ßá‡¶¨‡ßá
            if (document.getElementById('app-container').innerHTML.includes('loader')) {
                renderCurrentPage();
            }
        };

        /**
         * ‡¶∞‡¶ø‡ßü‡ßá‡¶≤-‡¶ü‡¶æ‡¶á‡¶Æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶è‡¶ï‡¶ü‡¶ø ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶≠‡¶æ‡¶≤ ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßá‡•§
         */
        const startRealtimeUpdates = () => {
            // ‡¶™‡ßç‡¶∞‡¶§‡¶ø 7 ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°‡ßá ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶•‡ßá‡¶ï‡ßá ‡¶°‡ßá‡¶ü‡¶æ ‡¶Ü‡¶®‡¶æ‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶ï‡¶∞‡¶£
            setInterval(fetchDataFromServer, 7000);
        };


        // --- Core Game Logic ---
        const collectCoins = () => {
            const amount = state.coinsPerTick * state.coinMultiplier;
            state.userData.balance += amount;
            
            state.transactions.unshift({
                type: 'GRIP',
                amount: amount,
                multiplier: state.coinMultiplier,
                timestamp: new Date()
            });
            
            updateBalanceDisplay();
        };

        const handleTapStart = () => {
            if (state.isTapping) return;
            
            state.isTapping = true;
            state.tapInterval = setInterval(collectCoins, 1000);
            
            const tapTimer = setInterval(() => {
                if (!state.isTapping) {
                    clearInterval(tapTimer);
                    return;
                }
                state.coinMultiplier = Math.min(5, state.coinMultiplier + 1);
                renderCurrentPage();
            }, 200);
            
            renderCurrentPage();
        };

        const handleTapEnd = () => {
            if (!state.isTapping) return;
            
            state.isTapping = false;
            clearInterval(state.tapInterval);
            
            if (!state.adRewardActive) {
                state.coinMultiplier = 1;
            }
            
            renderCurrentPage();
        };

        // --- Transfer Logic ---
        const searchRecipient = () => {
            const recipientInput = document.getElementById('transferRecipient');
            const recipientName = recipientInput.value.trim();
            
            if (!recipientName) {
                showStatus('‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ ‡¶¶‡¶ø‡¶®‡•§', true);
                return;
            }
            
            showStatus('‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...');
            
            // Simulate API call
            setTimeout(() => {
                if (recipientName.toLowerCase() === 'admin') {
                    state.recipientData = {
                        username: 'admin',
                        uid: '7243906826'
                    };
                    showStatus('‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶ó‡ßá‡¶õ‡ßá: admin');
                } else {
                    state.recipientData = null;
                    showStatus('‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§', true);
                }
                renderCurrentPage();
            }, 1000);
        };

        const confirmTransfer = () => {
            const amountInput = document.getElementById('transferAmount');
            const amount = parseFloat(amountInput.value);
            
            if (!state.recipientData || !amount || amount <= 0 || amount > state.userData.balance) {
                showStatus('‡¶ü‡¶æ‡¶ï‡¶æ ‡¶¨‡¶æ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ ‡¶∏‡¶†‡¶ø‡¶ï ‡¶®‡ßü‡•§', true);
                return;
            }
            
            showStatus('‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶∏‡¶´‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ ‡¶ö‡¶≤‡¶õ‡ßá...');
            
            // Simulate transfer processing
            setTimeout(() => {
                state.userData.balance -= amount;
                
                state.transactions.unshift({
                    type: 'TRANSFER_SENT',
                    amount: -amount,
                    recipient: state.recipientData.username,
                    timestamp: new Date()
                });
                
                showStatus(`‡¶∏‡¶´‡¶≤! ${amount} ‡¶ï‡¶Ø‡¶º‡ßá‡¶® ${state.recipientData.username}-‡¶ï‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§`);
                
                // Reset form
                document.getElementById('transferRecipient').value = '';
                document.getElementById('transferAmount').value = '';
                state.transferRecipient = '';
                state.transferAmount = '';
                state.recipientData = null;
                
                updateBalanceDisplay();
                renderCurrentPage();
            }, 1500);
        };

        // --- News System ---
        const handlePostNews = () => {
            const titleInput = document.getElementById('newPostTitle');
            const captionInput = document.getElementById('newPostCaption');
            const linkInput = document.getElementById('newPostLink');
            
            const title = titleInput.value.trim();
            const caption = captionInput.value.trim();
            const link = linkInput.value.trim();
            
            if (!title || !caption || !link) {
                showStatus('‡¶∏‡¶¨ ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§', true);
                return;
            }
            
            // Check if user is admin
            if (state.userData.telegramId !== '7243906826') {
                showStatus('‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶®‡¶ø‡¶â‡¶ú ‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§', true);
                return;
            }
            
            showStatus('‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...');
            
            state.newsPosts.unshift({
                title: title,
                caption: caption,
                buttonLink: link,
                timestamp: new Date()
            });
            
            // Clear form
            titleInput.value = '';
            captionInput.value = '';
            linkInput.value = '';
            
            showStatus('‡¶®‡¶ø‡¶â‡¶ú ‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
            renderCurrentPage();
        };

        // --- Rendering Functions ---
        const updateBalanceDisplay = () => {
            const balanceEl = document.getElementById('user-balance');
            if (balanceEl) {
                balanceEl.querySelector('p:last-child').textContent = formatBalance(state.userData.balance);
            }
        };

        const renderGripPage = () => {
            const minutes = Math.floor(state.adRewardDuration / 60);
            const seconds = state.adRewardDuration % 60;
            const formattedTime = `${minutes}‡¶Æ‡¶ø ${seconds}‡¶∏‡ßá`;
            
            return `
                <div class="p-4 h-full bg-transparent">
                    <div class="text-center mb-8">
                        <h2 class="text-2xl font-bold text-teal-400 mb-2">‡¶ï‡ßü‡ßá‡¶® ‡¶∏‡¶Ç‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
                        <p class="text-sm text-gray-400">
                            ‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶®! ‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ${state.coinMultiplier}√ó ‡¶∏‡ßç‡¶™‡¶ø‡¶°‡•§ 
                            ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°‡ßá ${state.coinsPerTick * state.coinMultiplier} ‡¶ï‡¶Ø‡¶º‡ßá‡¶®‡•§
                        </p>
                    </div>
                    
                    <!-- Ad Reward Section -->
                    <div class="mb-6 p-4 bg-slate-800/50 rounded-xl border border-slate-700">
                        <div class="flex justify-between items-center mb-3">
                            <div class="flex items-center space-x-2">
                                <svg class="w-5 h-5 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                </svg>
                                <span class="text-sm font-semibold">
                                    ${state.adRewardActive ? '‡ß´√ó ‡¶∏‡ßç‡¶™‡¶ø‡¶° ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶ü‡¶ø‡¶≠!' : '‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßá ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶®‡¶ø‡¶®'}
                                </span>
                            </div>
                            <span class="text-xs text-yellow-300">
                                ${state.adRewardActive ? formattedTime : '‡¶®‡¶ø‡¶∑‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º'}
                            </span>
                        </div>
                        <button 
                            onclick="showMonetagRewardedAd()"
                            ${state.adRewardActive ? 'disabled' : ''}
                            class="w-full py-3 bg-teal-600 hover:bg-teal-700 disabled:bg-slate-700 disabled:text-gray-400 rounded-lg font-bold transition duration-200"
                        >
                            ${state.adRewardActive ? '‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶ö‡¶≤‡¶õ‡ßá...' : 'Rewarded Ad ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® (‡ß´√ó ‡¶Æ‡¶æ‡¶≤‡ßç‡¶ü‡¶ø‡¶™‡ßç‡¶≤‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞)'}
                        </button>
                    </div>

                    <!-- Bonus Coin Section -->
                    <div class="mb-8 p-4 bg-purple-800/30 rounded-xl border border-purple-700">
                        <div class="flex items-center space-x-2 mb-3">
                            <svg class="w-5 h-5 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12zm-7 4h14M5 12a2 2 0 110-4h14a2 2 0 110 4M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"></path>
                            </svg>
                            <span class="text-sm font-semibold">‡¶è‡¶ï‡ßç‡¶∏‡¶ü‡ßç‡¶∞‡¶æ ‡¶ï‡¶Ø‡¶º‡ßá‡¶® ‡¶¨‡ßã‡¶®‡¶æ‡¶∏</span>
                        </div>
                        <button 
                            onclick="showMonetagRewardedPopup()"
                            class="w-full py-3 bg-purple-600 hover:bg-purple-700 rounded-lg font-bold transition duration-200"
                        >
                            Rewarded Popup ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® (‡ßß‡ß¶‡ß¶ ‡¶ï‡¶Ø‡¶º‡ßá‡¶® ‡¶¨‡ßã‡¶®‡¶æ‡¶∏)
                        </button>
                    </div>

                    <!-- Tapping Zone -->
                    <div class="flex justify-center mb-8">
                        <div 
                            id="tapZone"
                            ontouchstart="handleTapStart()"
                            ontouchend="handleTapEnd()"
                            onmousedown="handleTapStart()"
                            onmouseup="handleTapEnd()"
                            class="w-64 h-64 flex items-center justify-center rounded-full shadow-2xl transition-all duration-100 ease-out 
                                ${state.isTapping ? 'bg-teal-700/80 scale-105' : 'bg-slate-800/80 hover:bg-slate-700/80'} 
                                ${state.coinMultiplier > 1 ? 'border-4 border-yellow-400 pulse-animation' : 'border border-slate-600'}"
                        >
                            <div class="text-center">
                                <p class="text-6xl mb-2">üëä</p>
                                <p class="text-2xl font-extrabold ${state.coinMultiplier > 1 ? 'text-yellow-400' : 'text-white'}">
                                    ${state.coinMultiplier}√ó
                                </p>
                                ${state.isTapping ? '<p class="text-sm text-gray-300 mt-2">‡¶ï‡¶Ø‡¶º‡ßá‡¶® ‡¶∏‡¶Ç‡¶ó‡ßç‡¶∞‡¶π ‡¶ö‡¶≤‡¶õ‡ßá...</p>' : ''}
                            </div>
                        </div>
                    </div>

                    <!-- Stats -->
                    <div class="text-center">
                        <p class="text-gray-400 text-sm">‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶∏‡¶Ç‡¶ó‡ßç‡¶∞‡¶π ‡¶∞‡ßá‡¶ü</p>
                        <p class="text-2xl font-bold text-white">
                            ${state.coinsPerTick * state.coinMultiplier} ‡¶ï‡¶Ø‡¶º‡ßá‡¶®/‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°
                        </p>
                    </div>
                </div>
            `;
        };

        const renderTransferPage = () => {
            return `
                <div class="p-4 h-full bg-transparent">
                    <div class="text-center mb-6">
                        <h2 class="text-2xl font-bold text-teal-400 mb-2">‡¶ï‡ßü‡ßá‡¶® ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶∏‡¶´‡¶æ‡¶∞</h2>
                        <p class="text-sm text-gray-400">‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶ï‡ßá ‡¶ï‡¶Ø‡¶º‡ßá‡¶® ‡¶™‡¶æ‡¶†‡¶æ‡¶®</p>
                    </div>
                    
                    <div class="space-y-6 max-w-md mx-auto">
                        <!-- Recipient Search -->
                        <div class="p-4 bg-slate-800/50 rounded-xl border border-slate-700">
                            <label class="block text-sm font-medium text-gray-300 mb-2">Telegram Username</label>
                            <div class="flex space-x-2">
                                <input
                                    type="text"
                                    id="transferRecipient"
                                    placeholder="@username"
                                    class="flex-grow p-3 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-gray-500 focus:ring-2 focus:ring-teal-500 focus:border-transparent"
                                />
                                <button
                                    onclick="searchRecipient()"
                                    class="px-4 py-3 bg-pink-600 hover:bg-pink-700 rounded-lg font-semibold transition duration-200"
                                >
                                    ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö
                                </button>
                            </div>
                        </div>

                        <!-- Recipient Info -->
                        ${state.recipientData ? `
                            <div class="p-4 bg-slate-700/50 rounded-xl border border-teal-500/50">
                                <h3 class="text-lg font-semibold text-teal-300 mb-2">‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶∏‡¶´‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶æ‡¶™‡¶ï:</h3>
                                <p class="text-white">‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ: <span class="font-bold">${state.recipientData.username}</span></p>
                            </div>
                        ` : ''}
                        
                        <!-- Transfer Form -->
                        <div class="p-4 bg-slate-800/50 rounded-xl border border-slate-700">
                            <label class="block text-sm font-medium text-gray-300 mb-2">‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ (‡¶ï‡¶Ø‡¶º‡ßá‡¶®)</label>
                            <input
                                type="number"
                                id="transferAmount"
                                placeholder="‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®"
                                class="w-full p-3 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-gray-500 focus:ring-2 focus:ring-teal-500 focus:border-transparent mb-4"
                            />
                            
                            <p class="text-sm text-gray-400 mb-4">
                                ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏: <span class="font-semibold text-white">${formatBalance(state.userData.balance)}</span> ‡¶ï‡¶Ø‡¶º‡ßá‡¶®
                            </p>

                            <button
                                onclick="confirmTransfer()"
                                ${!state.recipientData ? 'disabled' : ''}
                                class="w-full py-3 bg-teal-600 hover:bg-teal-700 disabled:bg-slate-700 disabled:text-gray-400 rounded-lg font-bold transition duration-200"
                            >
                                ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶∏‡¶´‡¶æ‡¶∞ ‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ
                            </button>
                        </div>
                    </div>
                </div>
            `;
        };

        const renderNewsPage = () => {
            const isAdmin = state.userData.telegramId === '7243906826';
            
            return `
                <div class="p-4 h-full bg-transparent">
                    <div class="text-center mb-6">
                        <h2 class="text-2xl font-bold text-teal-400 mb-2">‡¶ñ‡¶¨‡¶∞ ‡¶è‡¶¨‡¶Ç ‡¶Ü‡¶™‡¶°‡ßá‡¶ü</h2>
                        <p class="text-sm text-gray-400">‡¶∏‡¶∞‡ßç‡¶¨‡¶∂‡ßá‡¶∑ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶è‡¶¨‡¶Ç ‡¶ò‡ßã‡¶∑‡¶£‡¶æ</p>
                    </div>
                    
                    ${isAdmin ? `
                        <div class="mb-6 p-4 bg-red-900/20 rounded-xl border border-red-700">
                            <h3 class="text-lg font-semibold text-red-300 mb-3">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶´‡¶∞‡ßç‡¶Æ</h3>
                            <input
                                type="text"
                                id="newPostTitle"
                                placeholder="‡¶™‡ßã‡¶∏‡ßç‡¶ü‡ßá‡¶∞ ‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ"
                                class="w-full p-3 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-gray-500 mb-2"
                            />
                            <textarea
                                id="newPostCaption"
                                placeholder="‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶™‡¶∂‡¶®..."
                                class="w-full p-3 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-gray-500 h-20 mb-2"
                            ></textarea>
                            <input
                                type="url"
                                id="newPostLink"
                                placeholder="‡¶¨‡¶æ‡¶ü‡¶® ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï (https://...)"
                                class="w-full p-3 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-gray-500 mb-3"
                            />
                            <button
                                onclick="handlePostNews()"
                                class="w-full py-3 bg-red-600 hover:bg-red-700 rounded-lg font-bold transition duration-200"
                            >
                                ‡¶®‡¶ø‡¶â‡¶ú ‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
                            </button>
                        </div>
                    ` : ''}

                    <div class="space-y-4">
                        ${state.newsPosts.length > 0 ? 
                            state.newsPosts.map(post => `
                                <div class="p-4 bg-slate-800/50 rounded-xl border border-slate-700">
                                    <h3 class="text-xl font-bold text-teal-400 mb-2">${post.title}</h3>
                                    <p class="text-gray-300 mb-3">${post.caption}</p>
                                    <div class="flex justify-between items-center">
                                        <a 
                                            href="${post.buttonLink}" 
                                            target="_blank"
                                            class="px-4 py-2 bg-pink-600 hover:bg-pink-700 rounded-lg font-semibold transition duration-200"
                                        >
                                            Join/Check ‡¶ï‡¶∞‡ßÅ‡¶®
                                        </a>
                                        <p class="text-xs text-gray-500">${formatDate(post.timestamp)}</p>
                                    </div>
                                </div>
                            `).join('')
                        : `
                            <div class="text-center py-8">
                                <p class="text-gray-500">‡¶è‡¶ñ‡¶®‡¶ì ‡¶ï‡ßã‡¶®‡ßã ‡¶®‡¶ø‡¶â‡¶ú ‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶π‡¶Ø‡¶º‡¶®‡¶ø‡•§</p>
                            </div>
                        `}
                    </div>
                </div>
            `;
        };

        const renderProfilePage = () => {
            return `
                <div class="p-4 h-full bg-transparent">
                    <div class="text-center mb-6">
                        <h2 class="text-2xl font-bold text-teal-400 mb-2">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶è‡¶¨‡¶Ç ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø</h2>
                        <p class="text-sm text-gray-400">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶è‡¶¨‡¶Ç ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®‡ßá‡¶∞ ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</p>
                    </div>
                    
                    <div class="space-y-6 max-w-md mx-auto">
                        <!-- User Info -->
                        <div class="p-4 bg-slate-800/50 rounded-xl border border-teal-500/50">
                            <div class="flex items-center space-x-3 mb-4">
                                <div class="w-12 h-12 bg-teal-500 rounded-full flex items-center justify-center">
                                    <span class="text-lg font-bold">üë§</span>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-400">‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ</p>
                                    <p class="text-lg font-bold text-white">${state.userData.telegramUsername}</p>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <p class="text-sm text-gray-400">‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶ï‡ßã‡¶°</p>
                                    <p class="font-mono text-white">${state.userData.referralCode}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-400">‡¶Æ‡ßã‡¶ü ‡¶ï‡¶Ø‡¶º‡ßá‡¶®</p>
                                    <p class="text-lg font-bold text-teal-400">${formatBalance(state.userData.balance)}</p>
                                </div>
                            </div>
                        </div>

                        <!-- Referral System -->
                        <div class="p-4 bg-slate-800/50 rounded-xl border border-slate-700">
                            <h3 class="text-lg font-semibold text-pink-400 mb-3">‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ</h3>
                            <p class="text-sm text-gray-300 mb-4">
                                ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡¶¶‡ßá‡¶∞ ‡¶Ü‡¶Æ‡¶®‡ßç‡¶§‡ßç‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶ï‡¶Æ‡¶ø‡¶∂‡¶® ‡¶â‡¶™‡¶æ‡¶∞‡ßç‡¶ú‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®
                            </p>
                            <div class="bg-slate-700/50 p-3 rounded-lg">
                                <p class="text-sm text-gray-400 mb-1">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï:</p>
                                <p class="text-xs font-mono text-white break-all p-2 bg-slate-600 rounded">
                                    https://t.me/your_bot?start=${state.userData.referralCode}
                                </p>
                            </div>
                        </div>
                        
                        <!-- Transaction History -->
                        <div class="p-4 bg-slate-800/50 rounded-xl border border-slate-700">
                            <h3 class="text-lg font-semibold text-teal-400 mb-3">‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø</h3>
                            <div class="space-y-3 max-h-60 overflow-y-auto">
                                ${state.transactions.length > 0 ? 
                                    state.transactions.map(tx => `
                                        <div class="flex justify-between items-center p-3 bg-slate-700/30 rounded-lg">
                                            <div>
                                                <p class="font-medium">
                                                    ${tx.type === 'GRIP' ? '‡¶ï‡¶Ø‡¶º‡ßá‡¶® ‡¶∏‡¶Ç‡¶ó‡ßç‡¶∞‡¶π' :
                                                      tx.type === 'TRANSFER_SENT' ? '‡¶ï‡¶Ø‡¶º‡ßá‡¶® ‡¶™‡ßç‡¶∞‡ßá‡¶∞‡¶£' :
                                                      tx.type === 'TRANSFER_RECEIVED' ? '‡¶ï‡¶Ø‡¶º‡ßá‡¶® ‡¶ó‡ßç‡¶∞‡¶π‡¶£' :
                                                      tx.type === 'AD_REWARD' ? '‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¨‡ßã‡¶®‡¶æ‡¶∏' :
                                                      tx.type === 'BACKGROUND_EARN' ? '‡¶∞‡¶ø‡ßü‡ßá‡¶≤‡¶ü‡¶æ‡¶á‡¶Æ ‡¶Ü‡¶∞‡ßç‡¶®‡¶ø‡¶Ç' : '‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø'}
                                                </p>
                                                <p class="text-xs text-gray-400">${formatDate(tx.timestamp)}</p>
                                            </div>
                                            <span class="font-bold ${tx.amount > 0 ? 'text-green-400' : 'text-red-400'}">
                                                ${tx.amount > 0 ? '+' : ''}${formatBalance(tx.amount)}
                                            </span>
                                        </div>
                                    `).join('')
                                : `
                                    <p class="text-center text-gray-500 py-4">‡¶ï‡ßã‡¶®‡ßã ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶®‡ßá‡¶á‡•§</p>
                                `}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        };

        const renderCurrentPage = () => {
            const container = document.getElementById('app-container');
            let content = '';
            
            switch (state.currentPage) {
                case 'grip':
                    content = renderGripPage();
                    break;
                case 'transfer':
                    content = renderTransferPage();
                    break;
                case 'news':
                    content = renderNewsPage();
                    break;
                case 'profile':
                    content = renderProfilePage();
                    break;
                default:
                    content = '<div class="p-4 text-center">‡¶™‡ßá‡¶ú ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø</div>';
            }
            
            container.innerHTML = content;
            updateBalanceDisplay();
        };

        // --- Navigation ---
        const setupNavigation = () => {
            const navButtons = document.querySelectorAll('.nav-btn');
            navButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const page = btn.getAttribute('data-page');
                    state.currentPage = page;
                    
                    // Update active state
                    navButtons.forEach(b => {
                        b.classList.remove('text-teal-400', 'scale-110');
                        b.classList.add('text-gray-400', 'hover:text-teal-300');
                    });
                    btn.classList.remove('text-gray-400', 'hover:text-teal-300');
                    btn.classList.add('text-teal-400', 'scale-110');
                    
                    renderCurrentPage();
                    
                    // Show interstitial ad on page change (except grip page)
                    if (page !== 'grip') {
                        setTimeout(showAutoInterstitialAd, 500);
                    }
                });
            });
        };

        // --- Initialize App (UPDATED) ---
        const initApp = async () => {
            initTelegramApp(); // ‡¶á‡¶®‡¶ø‡¶∂‡¶ø‡ßü‡¶æ‡¶≤ ‡¶∏‡ßç‡¶ü‡ßá‡¶ü ‡¶∏‡ßá‡¶ü‡¶Ü‡¶™ ‡¶ï‡¶∞‡ßá (TG ‡¶¨‡¶æ ‡¶°‡ßá‡¶Æ‡ßã)
            
            // ‡¶∞‡¶ø‡ßü‡ßá‡¶≤-‡¶ü‡¶æ‡¶á‡¶Æ ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡¶æ
            await fetchDataFromServer(); 
            
            setupNavigation();
            startRealtimeUpdates(); // ‡¶∞‡¶ø‡ßü‡ßá‡¶≤-‡¶ü‡¶æ‡¶á‡¶Æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶æ
            
            // Show welcome message
            setTimeout(() => {
                showStatus(`‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ ${state.userData.telegramUsername}! Grip Coin ‡¶è ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ`);
            }, 1000);
        };

        // Start the app when page loads
        window.addEventListener('DOMContentLoaded', initApp);

        // Make functions globally available
        window.handleTapStart = handleTapStart;
        window.handleTapEnd = handleTapEnd;
        window.searchRecipient = searchRecipient;
        window.confirmTransfer = confirmTransfer;
        window.handlePostNews = handlePostNews;
        window.showMonetagRewardedAd = showMonetagRewardedAd;
        window.showMonetagRewardedPopup = showMonetagRewardedPopup;
    </script>
</body>
</html>
